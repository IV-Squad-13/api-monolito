DROP TABLE IF EXISTS tb_revisao CASCADE;
DROP TABLE IF EXISTS tb_empreendimento CASCADE;
DROP TABLE IF EXISTS tb_composicao_ambiente CASCADE;
DROP TABLE IF EXISTS tb_composicao_material CASCADE;
DROP TABLE IF EXISTS tb_item_ambiente CASCADE;
DROP TABLE IF EXISTS tb_marca_material CASCADE;

CREATE TABLE IF NOT EXISTS tb_composicao_ambiente
(
    id                BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    id_empreendimento BIGINT                                  NOT NULL,
    id_item_ambiente  BIGINT                                  NOT NULL,
    CONSTRAINT pk_tb_composicao_ambiente PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS tb_composicao_material
(
    id_composicao_material BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    id_empreendimento      BIGINT                                  NOT NULL,
    id_marca_material      BIGINT                                  NOT NULL,
    CONSTRAINT pk_tb_composicao_material PRIMARY KEY (id_composicao_material)
);

CREATE TABLE IF NOT EXISTS tb_empreendimento
(
    id_empreendimento BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    nm_empreendimento VARCHAR(40)                             NOT NULL,
    tp_status         VARCHAR(20)                             NOT NULL,
    CONSTRAINT pk_tb_empreendimento PRIMARY KEY (id_empreendimento)
);

CREATE TABLE IF NOT EXISTS tb_item_ambiente
(
    id_item_ambiente BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    id_item          BIGINT                                  NOT NULL,
    id_ambiente      BIGINT                                  NOT NULL,
    is_obrigatorio   BOOLEAN,
    CONSTRAINT pk_tb_item_ambiente PRIMARY KEY (id_item_ambiente)
);

CREATE TABLE IF NOT EXISTS tb_marca_material
(
    id_marca_material BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    id_marca          BIGINT                                  NOT NULL,
    id_material       BIGINT                                  NOT NULL,
    is_obrigatorio    BOOLEAN,
    CONSTRAINT pk_tb_marca_material PRIMARY KEY (id_marca_material)
);

CREATE TABLE IF NOT EXISTS tb_revisao
(
    id_revisao        BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    tp_status         VARCHAR(20)                             NOT NULL,
    id_empreendimento BIGINT                                  NOT NULL,
    CONSTRAINT pk_tb_revisao PRIMARY KEY (id_revisao)
);

ALTER TABLE tb_empreendimento
    ADD CONSTRAINT uc_tb_empreendimento_nm_empreendimento UNIQUE (nm_empreendimento);

ALTER TABLE tb_revisao
    ADD CONSTRAINT uc_tb_revisao_id_empreendimento UNIQUE (id_empreendimento);

ALTER TABLE tb_composicao_ambiente
    ADD CONSTRAINT FK_TB_COMPOSICAO_AMBIENTE_ON_ID_EMPREENDIMENTO FOREIGN KEY (id_empreendimento) REFERENCES tb_empreendimento (id_empreendimento);

ALTER TABLE tb_composicao_ambiente
    ADD CONSTRAINT FK_TB_COMPOSICAO_AMBIENTE_ON_ID_ITEM_AMBIENTE FOREIGN KEY (id_item_ambiente) REFERENCES tb_item_ambiente (id_item_ambiente);

ALTER TABLE tb_composicao_material
    ADD CONSTRAINT FK_TB_COMPOSICAO_MATERIAL_ON_ID_EMPREENDIMENTO FOREIGN KEY (id_empreendimento) REFERENCES tb_empreendimento (id_empreendimento);

ALTER TABLE tb_composicao_material
    ADD CONSTRAINT FK_TB_COMPOSICAO_MATERIAL_ON_ID_MARCA_MATERIAL FOREIGN KEY (id_marca_material) REFERENCES tb_marca_material (id_marca_material);

ALTER TABLE tb_item_ambiente
    ADD CONSTRAINT FK_TB_ITEM_AMBIENTE_ON_ID_AMBIENTE FOREIGN KEY (id_ambiente) REFERENCES tb_ambiente (id_ambiente);

ALTER TABLE tb_item_ambiente
    ADD CONSTRAINT FK_TB_ITEM_AMBIENTE_ON_ID_ITEM FOREIGN KEY (id_item) REFERENCES tb_item (id_item);

ALTER TABLE tb_marca_material
    ADD CONSTRAINT FK_TB_MARCA_MATERIAL_ON_ID_MARCA FOREIGN KEY (id_marca) REFERENCES tb_marca (id_marca);

ALTER TABLE tb_marca_material
    ADD CONSTRAINT FK_TB_MARCA_MATERIAL_ON_ID_MATERIAL FOREIGN KEY (id_material) REFERENCES tb_material (id_material);

ALTER TABLE tb_revisao
    ADD CONSTRAINT FK_TB_REVISAO_ON_ID_EMPREENDIMENTO FOREIGN KEY (id_empreendimento) REFERENCES tb_empreendimento (id_empreendimento);